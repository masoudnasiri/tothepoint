<!DOCTYPE html>
<html>
<head>
    <title>Test Frontend API Calls</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Test Frontend API Calls</h1>
    <div id="results"></div>
    <button onclick="testAPI()">Test API</button>
    
    <script>
        async function testAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing API calls...</p>';
            
            try {
                // Test health endpoint
                console.log('Testing health endpoint...');
                const healthResponse = await axios.get('/api/health');
                resultsDiv.innerHTML += `<p>Health: ${JSON.stringify(healthResponse.data)}</p>`;
                
                // Test login
                console.log('Testing login...');
                const loginResponse = await axios.post('/api/auth/login', {
                    username: 'finance1',
                    password: 'finance123'
                });
                const token = loginResponse.data.access_token;
                resultsDiv.innerHTML += `<p>Login: Success, Token: ${token.substring(0, 20)}...</p>`;
                
                // Test optimization
                console.log('Testing optimization...');
                const optimizationRequest = {
                    max_time_slots: 24,
                    time_limit_seconds: 300
                };
                
                const optimizationResponse = await axios.post('/api/finance/optimize', optimizationRequest, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                resultsDiv.innerHTML += `
                    <div style="background: green; color: white; padding: 10px; margin: 10px 0;">
                        <strong>Optimization Result:</strong><br>
                        Status: ${optimizationResponse.data.status}<br>
                        Total Cost: ${optimizationResponse.data.total_cost}<br>
                        Items Optimized: ${optimizationResponse.data.items_optimized}<br>
                        Message: ${optimizationResponse.data.message}
                    </div>
                `;
                
                // Test results
                console.log('Testing results...');
                const resultsResponse = await axios.get('/api/finance/optimization-results', {
                    headers: { Authorization: `Bearer ${token}` }
                });
                
                resultsDiv.innerHTML += `<p>Results: ${resultsResponse.data.length} items found</p>`;
                
            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML += `
                    <div style="background: red; color: white; padding: 10px; margin: 10px 0;">
                        <strong>Error:</strong> ${error.message}<br>
                        <strong>Response:</strong> ${error.response?.data ? JSON.stringify(error.response.data) : 'No response data'}<br>
                        <strong>Status:</strong> ${error.response?.status || 'No status'}<br>
                        <strong>URL:</strong> ${error.config?.url || 'No URL'}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
